{
    "version": "https://jsonfeed.org/version/1",
    "title": "Stay hungry , Stay foolish",
    "description": "巴拉巴拉",
    "home_page_url": "https://skyFlya.github.io",
    "items": [
        {
            "id": "https://skyflya.github.io/2022/05/25/Tmczkc3HqflAOpLK/",
            "url": "https://skyflya.github.io/2022/05/25/Tmczkc3HqflAOpLK/",
            "title": "如何在 VideoPlayer 上面放置 UI 控件",
            "date_published": "2022-05-25T15:39:16.000Z",
            "content_html": "<blockquote>\n<p>CoCos中在视频层上方放置ui</p>\n</blockquote>\n<span id=\"more\"></span>\n<p>最近使用Cocos Creator开发项目，有个需求是在视频上面添加按钮交互。由于视频调用的是系统原生控件，并且层级放置在了Cocos引擎层级之上，没有和游戏一起混合渲染，所以单纯在cocos这边改动 zIndex是没有效果的，必须要和对应平台打交道了。</p>\n<h1 id=\"为了实现视频上面放置ui，大概有三种思路：\">为了实现视频上面放置UI，大概有三种思路：<a title=\"#为了实现视频上面放置ui，大概有三种思路：\" href=\"#为了实现视频上面放置ui，大概有三种思路：\"></a></h1>\n<p>1.将视频层级放到cocos层级之下，这样cocos的UI就可以显示在视频之上了。<br>\n2.需要放置到视频层级上的UI不使用cocos内置控件，调用对应平台控件放置在视频控件之上。<br>\n3.获取视频数据，渲染到cocos控件上。</p>\n<p>第1、2种方式实现的最终效果一致。缺点是视频和cocos是分层显示的，所以视频只能放置在cocos控件的最下层。<br>\n第三种方式可以自由调整视频层级，但我还没有实现细节的思路，不做探讨。本文基于 Cocos Creator 2.0.7，其他版本引擎运行效果需自行测试。</p>\n<p><strong>我选择用第一种方式，简单粗暴</strong><br>\n首先要做的是把屏幕背景色设为透明，这一步骤在iOS、Android、Web上都需要做。<br>\n打开Creator把场景挂载的 Camera 组件上的 backgroundColor 的R、G、B、A全部设为 0 ，用于清除背景色。<br>\n然后在各个平台上调整视频层级到引擎层级下面。</p>\n<h1 id=\"ios端：\">iOS端：<a title=\"#ios端：\" href=\"#ios端：\"></a></h1>\n<p>// 先添加videoView再添加cocosView<br>\nUIViewController* rvC = [[UIViewController alloc]init];<br>\n// 视频view<br>\nUIView *videoView = [[UIView alloc] initWithFrame:bounds];<br>\nvideoView.tag = 10; // 通过tag找到view<br>\n[rvC.view addSubview:videoView];<br>\n// 引擎view<br>\nUIView *cocosView = _viewController.view;<br>\ncocosView.frame = bounds;//<br>\ncocosView.backgroundColor = [UIColor clearColor];<br>\n[rvC.view addSubview:cocosView];</p>\n<pre><code>// Set RootViewController to window\nif ( [[UIDevice currentDevice].systemVersion floatValue] &lt; 6.0)\n&#123;\n    // warning: addSubView doesn't work on iOS6\n     [window addSubview: rvC.view]; //新的rootView\n&#125;\nelse\n&#123;\n    // use this method on ios6\n    [window setRootViewController:rvC]; //新的rootView\n&#125;\n</code></pre>\n<p>具体如图：<br>\n<img src=\"https://s1.ax1x.com/2022/05/25/XFzwqg.png\" alt=\"bWKCWV.png\" loading=\"lazy\"><br>\n接着修改VideoPlayer的默认层级。在引擎文件 <a href=\"http://VideoPlayer-ios.mm\">VideoPlayer-ios.mm</a> 中找到[eaglviewaddSubview:self.moviePlayer.view]; 方法，注释掉添加到默认层级的代码。通过tag找到我们之前新建的视频view，并添加视频到上面。加入如下代码：<br>\n[[[eaglview superview] viewWithTag:10] addSubview:self.moviePlayer.view]; // 添加到上层view<br>\n这里还要改一下颜色格式，要不然视频还是会被黑色背景遮住。在引擎文件  <a href=\"http://CCApplication-ios.mm\">CCApplication-ios.mm</a> 中找到 onCreateView 方法，我们看到引擎默认像素格式是  RGB565 。注释掉原来代码，把这里改为支持透明度的 RGBA8 格式。RGB565这种格式是不支持透明度的，所以即使我们把 UIView设为透明，视频依然被黑色背景遮住。</p>\n<h1 id=\"android端：\">Android端：<a title=\"#android端：\" href=\"#android端：\"></a></h1>\n<p>首先取消视频置顶。找到 Cocos2dxVideoHelper.java 文件，注释掉 setZOrderOnTop 方法。<br>\n<img src=\"https://s1.ax1x.com/2022/05/25/XFzWsU.png\" alt=\"bWKCWV.png\" loading=\"lazy\"><br>\n紧接着，我们设置像素格式。在Android原生工程中，找到 AppActivity.java 文件，在 onCreateView 方法中添加设置 glSurfaceView 透明代码：(需要保证opengl的Config中有配置alpha通道)<br>\nCocos2dxGLSurfaceView glSurfaceView = new Cocos2dxGLSurfaceView(this);<br>\n//通常,为了使它与绘图树整合,这意味着它所在的窗口的其他内容都不可见，所以接下来我们需要设置surfaceView透明来使其他内容可见</p>\n<pre><code>    glSurfaceView.setEGLConfigChooser(8, 8, 8, 8, 16, 8);\t  //修改GLSurfaceView参数，其中第四个参数为AlphaSize，这样修改以后View就变透明了\n    glSurfaceView.getHolder().setFormat(PixelFormat.RGBA_8888);  //RGBA_8888为android的一种32位颜色格式，R,G,B,A分别用八位表示，Android默认格式是PixelFormat.OPAQUE，其是不带Alpha值的。\n    \n    //控制这个surfaceView是否被放在另一个普通的surfaceView上面（但是仍然在窗口之后）。这个函数通常被用来将覆盖层至于一个多媒体层上面。\n    //这个函数必须在窗口被添加到窗口管理器之前设置。\n    //调用这个函数会使之前调用的setZOrderOnTop(boolean)无效。\n    glSurfaceView.setZOrderMediaOverlay(true);\n</code></pre>\n<p><img src=\"https://s1.ax1x.com/2022/05/25/XkSCWt.png\" alt=\"bWKCWV.png\" loading=\"lazy\"><br>\n这时候视频已经可以显示在下方了，但是，如果视频上方有 cocos 按钮依然不可点击的，我们还需要向下传递事件。找到引擎目录下的  Cocos2dxVideoView.java  文件，重写 onTouchEvent方法，返回false 。这样视频上方的cocos ui就可以响应触摸事件了。<br>\n<img src=\"https://s1.ax1x.com/2022/05/25/XkSwSx.png\" alt=\"bWKCWV.png\" loading=\"lazy\"></p>\n<h1 id=\"web端：\">Web端：<a title=\"#web端：\" href=\"#web端：\"></a></h1>\n<p>和Android、iOS一样，首先是调整视频层级到最下层。找到 js引擎 目录下的 video-player-impl.js 文件，在 _createDom 方法中添加修改视频层级代码：<br>\n// 调整视频层级到最下层<br>\nvideo.style.zIndex = -1;<br>\n修改代码后还需要编译一下 js引擎 到engine目录下执行一下 gulp build 构建成功后，才能使修改的代码生效。<br>\n如果不想重新编译引擎，可以直接找到 js引擎 bin 文件夹下的 cocos2d-js-for-preview.js 文件搜索_createDom 方法中添加以上代码。<br>\n最后我们需要Canvas 背景是透明的，这样才能看到下层的视频。如果是开发时在网页上预览，需要修改Cocos Creator安装目录下， 找到preview-templates 文件夹下的 boot.js 文件，在 cc.game.run 之前加上如下代码：<br>\n// 开启支持全透明<br>\ncc.macro.ENABLE_TRANSPARENT_CANVAS = true;<br>\n如果是打web包，则在 main.js 文件中的 cc.game.run 代码之前加入以上代码。</p>\n",
            "tags": [
                "CoCosCreator",
                "UI组件"
            ]
        },
        {
            "id": "https://skyflya.github.io/2022/05/25/fhlS3Xe70jONJPD1/",
            "url": "https://skyflya.github.io/2022/05/25/fhlS3Xe70jONJPD1/",
            "title": "JS常用代码",
            "date_published": "2022-05-25T15:39:14.000Z",
            "content_html": "<blockquote>\n<p>部分Js常用方法</p>\n</blockquote>\n<span id=\"more\"></span>\n<h1 id=\"世界坐标和节点坐标转换\">世界坐标和节点坐标转换<a title=\"#世界坐标和节点坐标转换\" href=\"#世界坐标和节点坐标转换\"></a></h1>\n<p>//把cocos的坐标转成世界坐标pos1 （只能父节点转）<br>\nvar pos1 = this.cocos1.parent.convertToWorldSpaceAR(this.cocos1.getPosition());<br>\ncc.log(pos1)</p>\n<p>//把（世界坐标pos1）转成相对于节点cocos的坐标<br>\nvar pos2 = this.cocos1.convertToNodeSpaceAR(pos1);<br>\ncc.log(pos2)</p>\n<figure class=\"highlight reasonml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">* 节点坐标转换<span class=\"operator\"></span></span><br><span class=\"line\"><span class=\"operator\">* </span>@param node 欲要转换的节点<span class=\"operator\"></span></span><br><span class=\"line\"><span class=\"operator\">* </span>@param newParent 新父节点</span><br><span class=\"line\">*/</span><br><span class=\"line\">convert<span class=\"constructor\">ToParent(<span class=\"params\">node</span>: <span class=\"params\">cc</span>.Node, <span class=\"params\">newParent</span>: <span class=\"params\">cc</span>.Node, <span class=\"params\">offset</span>?: <span class=\"params\">cc</span>.Vec2)</span>: cc.Vec2 &#123;</span><br><span class=\"line\">    const worldPos = node.convert<span class=\"constructor\">ToWorldSpaceAR(<span class=\"params\">offset</span> <span class=\"operator\">||</span> <span class=\"params\">cc</span>.<span class=\"params\">v2</span>(0, 0)</span>);</span><br><span class=\"line\">    return newParent.convert<span class=\"constructor\">ToNodeSpaceAR(<span class=\"params\">worldPos</span>)</span>;</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n<h1 id=\"通过两点算出角度的方法\">通过两点算出角度的方法<a title=\"#通过两点算出角度的方法\" href=\"#通过两点算出角度的方法\"></a></h1>\n<figure class=\"highlight gml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getAngle:<span class=\"keyword\">function</span>(start,<span class=\"keyword\">end</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> <span class=\"symbol\">x</span> = <span class=\"keyword\">end</span>.<span class=\"symbol\">x</span> - start.<span class=\"symbol\">x</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> <span class=\"symbol\">y</span> = <span class=\"keyword\">end</span>.<span class=\"symbol\">y</span> - start.<span class=\"symbol\">y</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> hypotenuse = Math.<span class=\"built_in\">sqrt</span>(<span class=\"symbol\">x</span>*<span class=\"symbol\">x</span> + <span class=\"symbol\">y</span>*<span class=\"symbol\">y</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> <span class=\"built_in\">cos</span> = <span class=\"symbol\">x</span> / hypotenuse</span><br><span class=\"line\">    <span class=\"keyword\">var</span> radian = Math.acos(<span class=\"built_in\">cos</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//求出弧度</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> angle = <span class=\"number\">180</span> / (Math.PI / radian)</span><br><span class=\"line\">    <span class=\"comment\">//用弧度算出角度</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"symbol\">y</span> &lt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">        angle = <span class=\"number\">0</span>-angle</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(<span class=\"symbol\">y</span> == <span class=\"number\">0</span> &amp;&amp; <span class=\"symbol\">x</span> &lt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">        angle = <span class=\"number\">180</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">90</span>-angle</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n<h1 id=\"js去掉空格方法\">Js去掉空格方法<a title=\"#js去掉空格方法\" href=\"#js去掉空格方法\"></a></h1>\n<figure class=\"highlight processing\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//实现</span></span><br><span class=\"line\"><span class=\"keyword\">String</span>.prototype.<span class=\"built_in\">trim</span> = function() &#123;</span><br><span class=\"line\">  var <span class=\"built_in\">str</span> = <span class=\"keyword\">this</span>,</span><br><span class=\"line\">  <span class=\"built_in\">str</span> = <span class=\"built_in\">str</span>.replace(/^\\s\\s*/, <span class=\"string\">&#x27;&#x27;</span>),</span><br><span class=\"line\">  ws = /\\s/,</span><br><span class=\"line\">  i = <span class=\"built_in\">str</span>.length;</span><br><span class=\"line\">  <span class=\"keyword\">while</span> (ws.test(<span class=\"built_in\">str</span>.charAt(--i)));</span><br><span class=\"line\">  <span class=\"keyword\">return</span> <span class=\"built_in\">str</span>.slice(<span class=\"number\">0</span>, i + <span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> greeting = <span class=\"string\">&#x27;   Hello world!   &#x27;</span>;</span><br><span class=\"line\">console.<span class=\"built_in\">log</span>(greeting.<span class=\"built_in\">trim</span>()); <span class=\"comment\">//执行</span></span><br></pre></td></tr></table></figure>\n<h1 id=\"输入一个值，返回其数据类型\">输入一个值，返回其数据类型<a title=\"#输入一个值，返回其数据类型\" href=\"#输入一个值，返回其数据类型\"></a></h1>\n<figure class=\"highlight ada\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title\">type</span>(para) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">Object.prototype.toString.call(para)</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"数组去重\">数组去重<a title=\"#数组去重\" href=\"#数组去重\"></a></h1>\n<figure class=\"highlight arcade\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">unique1</span>(<span class=\"params\">arr</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [...<span class=\"keyword\">new</span> Set(arr)]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">unique2</span>(<span class=\"params\">arr</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> obj = &#123;&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> arr.filter(<span class=\"function\"><span class=\"params\">ele</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!obj[ele]) &#123;</span><br><span class=\"line\">            obj[ele] = <span class=\"literal\">true</span>;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">unique3</span>(<span class=\"params\">arr</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> result = [];</span><br><span class=\"line\">    arr.forEach(<span class=\"function\"><span class=\"params\">ele</span> =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (result.indexOf(ele) == <span class=\"number\">-1</span>) &#123;</span><br><span class=\"line\">            result.push(ele)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"字符串去重\">字符串去重<a title=\"#字符串去重\" href=\"#字符串去重\"></a></h1>\n<figure class=\"highlight kotlin\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">String.prototype.unique = function () &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> obj = &#123;&#125;,</span><br><span class=\"line\">        str = <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">        len = <span class=\"keyword\">this</span>.length;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; len; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!obj[<span class=\"keyword\">this</span>[i]]) &#123;</span><br><span class=\"line\">            str += <span class=\"keyword\">this</span>[i];</span><br><span class=\"line\">            obj[<span class=\"keyword\">this</span>[i]] = <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> str;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">###### <span class=\"comment\">//去除连续的字符串 </span></span><br><span class=\"line\">function uniq(str) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> str.replace(/(\\w)\\<span class=\"number\">1</span>+/g, <span class=\"string\">&#x27;$1&#x27;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"深拷贝-浅拷贝\">深拷贝 浅拷贝<a title=\"#深拷贝-浅拷贝\" href=\"#深拷贝-浅拷贝\"></a></h1>\n<figure class=\"highlight stata\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//深克隆（深克隆不考虑函数）</span></span><br><span class=\"line\">function deepClone(obj, result) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> result = result || &#123;&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> <span class=\"keyword\">prop</span> <span class=\"keyword\">in</span> obj) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (obj.hasOwnProperty(<span class=\"keyword\">prop</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> obj[<span class=\"keyword\">prop</span>] == &#x27;object&#x27; &amp;&amp; obj[<span class=\"keyword\">prop</span>] !== null) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 引用值(obj/array)且不为null</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (Object.prototype.<span class=\"keyword\">toString</span>.call(obj[<span class=\"keyword\">prop</span>]) == &#x27;[object Object]&#x27;) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// 对象</span></span><br><span class=\"line\">                    result[<span class=\"keyword\">prop</span>] = &#123;&#125;;</span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// 数组</span></span><br><span class=\"line\">                    result[<span class=\"keyword\">prop</span>] = [];</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                deepClone(obj[<span class=\"keyword\">prop</span>], result[<span class=\"keyword\">prop</span>])</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 原始值或func</span></span><br><span class=\"line\">        result[<span class=\"keyword\">prop</span>] = obj[<span class=\"keyword\">prop</span>]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 深浅克隆是针对引用值</span></span><br><span class=\"line\">function deepClone(target) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"keyword\">typeof</span> (target) !== &#x27;object&#x27;) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> target;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> result;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (Object.prototype.<span class=\"keyword\">toString</span>.call(target) == &#x27;[object Array]&#x27;) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 数组</span></span><br><span class=\"line\">        result = []</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 对象</span></span><br><span class=\"line\">        result = &#123;&#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> <span class=\"keyword\">prop</span> <span class=\"keyword\">in</span> target) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (target.hasOwnProperty(<span class=\"keyword\">prop</span>)) &#123;</span><br><span class=\"line\">            result[<span class=\"keyword\">prop</span>] = deepClone(target[<span class=\"keyword\">prop</span>])</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"防抖\">防抖<a title=\"#防抖\" href=\"#防抖\"></a></h1>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">debounce</span>(<span class=\"params\">handle, delay</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> timer = <span class=\"literal\">null</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> _self = <span class=\"built_in\">this</span>,</span><br><span class=\"line\">            _args = <span class=\"built_in\">arguments</span>;</span><br><span class=\"line\">        <span class=\"built_in\">clearTimeout</span>(timer);</span><br><span class=\"line\">        timer = <span class=\"built_in\">setTimeout</span>(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            handle.apply(_self, _args)</span><br><span class=\"line\">        &#125;, delay)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h1 id=\"节流\">节流<a title=\"#节流\" href=\"#节流\"></a></h1>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">throttle</span>(<span class=\"params\">handler, wait</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> lastTime = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">var</span> nowTime = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (nowTime - lastTime &gt; wait) &#123;</span><br><span class=\"line\">            handler.apply(<span class=\"built_in\">this</span>, <span class=\"built_in\">arguments</span>);</span><br><span class=\"line\">            lastTime = nowTime;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>",
            "tags": [
                "JS",
                "工具类"
            ]
        },
        {
            "id": "https://skyflya.github.io/2022/05/25/mK3j7ZNSzWeqzUeI/",
            "url": "https://skyflya.github.io/2022/05/25/mK3j7ZNSzWeqzUeI/",
            "title": "Cocos和Android对接文档",
            "date_published": "2022-05-25T15:39:13.000Z",
            "content_html": "<blockquote>\n<p>CoCos构建后利用Android Studio发布apk包流程</p>\n</blockquote>\n<span id=\"more\"></span>\n<h1 id=\"一、构建apk安装包\">一、构建apk安装包<a title=\"#一、构建apk安装包\" href=\"#一、构建apk安装包\"></a></h1>\n<p>1.下载安装Android Studio开发环境，拉取对应的Android项目代码，切换到指定Git分支。<br>\n2.构建Cocos Creator项目，将构建完成的【assets、jsb-adapter、src、main.js、project.json】（一般是在Cocos项目【build/jsb-default】目录中）复制到Android项目的【game/src/main/assets】目录。<br>\n<img src=\"https://s1.ax1x.com/2022/05/25/XkCB60.png\" alt=\"bWKCWV.png\" loading=\"lazy\"><br>\n<img src=\"https://s1.ax1x.com/2022/05/25/XkC67F.png\" alt=\"bWKCWV.png\" loading=\"lazy\"><br>\n<img src=\"https://s1.ax1x.com/2022/05/25/XkCRh9.png\" alt=\"bWKCWV.png\" loading=\"lazy\"><br>\n3.构建apk安装包前，先点击Android Studio右上角的【Sync Project With Gradle Files】，再点击Android Studio工具栏的【Build – Clean Project】，等编译完成后，点击Android Studio右侧【Gradle – BoomBoom – app – Task – channel】中的【channelDebug】或者【channelRelease】构建【测试】或者【正式】apk安装包，构建完成的apk文件在Android项目下的【app/channel/debug(releases)】中。<br>\n<img src=\"https://s1.ax1x.com/2022/05/25/XkCLhd.png\" alt=\"bWKCWV.png\" loading=\"lazy\"><br>\n<img src=\"https://s1.ax1x.com/2022/05/25/XkPSnf.png\" alt=\"bWKCWV.png\" loading=\"lazy\"><br>\n<img src=\"https://s1.ax1x.com/2022/05/25/XkPPAg.png\" alt=\"bWKCWV.png\" loading=\"lazy\"><br>\n4.如果需要真机运行代码，需要用USB连接线插入手机到电脑，打开手机的开发者选项，开启USB调试，点击Android Studio的【Run ‘app’】即可运行到手机。<br>\n<img src=\"https://s1.ax1x.com/2022/05/25/XkPFhj.png\" alt=\"bWKCWV.png\" loading=\"lazy\"></p>\n",
            "tags": [
                "CoCosCreator",
                "Android"
            ]
        },
        {
            "id": "https://skyflya.github.io/2022/05/25/Wsj4BSG3DcmlUTlE/",
            "url": "https://skyflya.github.io/2022/05/25/Wsj4BSG3DcmlUTlE/",
            "title": "JS number 精度丢失问题",
            "date_published": "2022-05-25T15:39:11.000Z",
            "content_html": "<blockquote>\n<p>数值位大引发的精准度问题</p>\n</blockquote>\n<span id=\"more\"></span>\n<h1 id=\"如果数值超过16位，就用string类型！否则序列化后数值会不准！\"><strong>如果数值超过16位，就用String类型！否则序列化后数值会不准！</strong><a title=\"#如果数值超过16位，就用string类型！否则序列化后数值会不准！\" href=\"#如果数值超过16位，就用string类型！否则序列化后数值会不准！\"></a></h1>\n<h1 id=\"例子：\">例子：<a title=\"#例子：\" href=\"#例子：\"></a></h1>\n<p>用户反馈自己的用户ID，需要做一些业务操作，结果发现通过用户截图的用户ID，并不能在数据库里找到该用户<br>\n后经发现，客户端 JS 受制于 精准度 的问题，一旦长度超过16位，就会导致序列化后不准</p>\n<p>服务器发送的数据，userid， 浏览器实际接收到的数据<br>\n<img src=\"https://s1.ax1x.com/2022/05/25/XkP2b8.png\" alt=\"bWKCWV.png\" loading=\"lazy\"></p>\n<p>客户端序列化后的数据，可以看到数值已经变了<br>\n<img src=\"https://s1.ax1x.com/2022/05/25/XkPfUg.png\" alt=\"bWKCWV.png\" loading=\"lazy\"></p>\n<h1 id=\"解决方案：\">解决方案：<a title=\"#解决方案：\" href=\"#解决方案：\"></a></h1>\n<p>超过16位的数值，对应服务器long类型，下发一律使用string。</p>\n",
            "tags": [
                "JS"
            ]
        },
        {
            "id": "https://skyflya.github.io/2022/05/23/Ca1AaW7p1PQIV0tF/",
            "url": "https://skyflya.github.io/2022/05/23/Ca1AaW7p1PQIV0tF/",
            "title": "Cocos 热更新简介、原理、流程、案例",
            "date_published": "2022-05-23T13:03:16.000Z",
            "content_html": "<blockquote>\n<p>Cocos 热更新介绍</p>\n</blockquote>\n<span id=\"more\"></span>\n<h1 id=\"简介：\">简介：<a title=\"#简介：\" href=\"#简介：\"></a></h1>\n<p>资源热更新是为游戏运行时动态更新资源而设计的，这里的资源可以是图片，音频甚至游戏逻辑。在游戏漫长的运营维护过程中，你将可以上传新的资源到你的服务器，让你的游戏跟踪远程服务器上的修改，自动下载新的资源到用户的设备上。就这样，全新的设计，新的游玩体验甚至全新的游戏内容都将立刻被推送到你的用户手上。重要的是，你不需要针对各个渠道去重新打包你的应用并经历痛苦的应用更新审核！</p>\n<h1 id=\"原理：\">原理：<a title=\"#原理：\" href=\"#原理：\"></a></h1>\n<p>热更新机制本质上是从服务器下载需要的资源到本地，并且可以执行新的游戏逻辑，让新资源可以被游戏所使用。<br>\n       Cocos 默认的热更新机制并不是基于补丁包更新的机制，传统的热更新经常对多个版本之间分别生成补丁包，按顺序下载补丁包并更新到最新版本。Cocos 的热更新机制通过直接比较最新版本和本地版本的差异来生成差异列表并更新。这样即可天然支持跨版本更新，比如本地版本为 A，远程版本是 C，则直接更新 A 和 C 之间的差异，并不需要生成 A 到 B 和 B 到 C 的更新包，依次更新。所以，在这种设计思路下，新版本的文件以离散的方式保存在服务端，更新时以文件为单位下载。</p>\n<h1 id=\"热更新基本流程：\">热更新基本流程：<a title=\"#热更新基本流程：\" href=\"#热更新基本流程：\"></a></h1>\n<p><img src=\"https://s1.ax1x.com/2022/05/24/XC8EU1.png\" alt=\"bWKCWV.png\" loading=\"lazy\" class=\"φbp\"></p>\n<h1 id=\"包内资源、本地缓存资源和临时资源：\">包内资源、本地缓存资源和临时资源：<a title=\"#包内资源、本地缓存资源和临时资源：\" href=\"#包内资源、本地缓存资源和临时资源：\"></a></h1>\n<p>在开发者的游戏安装到用户的手机上时，它的游戏是以 .ipa（iOS）或者 .apk（Android）形式存在的，这种应用包在安装后，它的内容是无法被修改或者添加的，应用包内的任何资源都会一直存在。所以热更新机制中，我们只能更新本地缓存到手机的可写目录下（应用存储空间或者 SD 卡指定目录），并通过 FileUtils 的搜索路径机制完成本地缓存对包内资源的覆盖。同时为了保障更新的可靠性，我们在更新过程中会首先将新版本资源放到一个临时文件夹中，只有当本次更新正常完成，才会替换到本地缓存文件夹内。如果中途中断更新或者更新失败，此时的失败版本都不会污染现有的本地缓存。<br>\n<strong>注意：大版本的更新的情况下（1.0.4-&gt;1.0.5），记得把临时文件夹清空（确保大版本的包体里面所带的manifest文件为最新，否则会用回之前热更新manifes文件）。</strong></p>\n<h1 id=\"断点续传:\">断点续传:<a title=\"#断点续传:\" href=\"#断点续传:\"></a></h1>\n<p>在中断之后，再次启动热更新流程时，会去检查临时文件夹中是否有未完成的更新，校验版本是否和远程匹配后，则直接使用临时文件夹中的 Manifest 作为 Remote Manifest 继续更新。此时，对于下载状态为已完成的，不会重新下载，对于下载中的文件，会尝试发送续传请求给服务器（服务器需要支持 Accept-Ranges，否则从头开始下载）。</p>\n<h1 id=\"manifest-格式：\">Manifest 格式：<a title=\"#manifest-格式：\" href=\"#manifest-格式：\"></a></h1>\n<p>Manifest 格式是我们用来比较本地和远程资源差异的一种 json 格式，其中保存了主版本信息、引擎版本信息、资源列表及资源信息等：<br>\n{<br>\n“packageUrl” :          远程资源的本地缓存根路径<br>\n“remoteVersionUrl” :    [可选项] 远程版本文件的路径，用来判断服务器端是否有新版本的资源<br>\n“remoteManifestUrl” :   远程资源 Manifest 文件的路径，包含版本信息以及所有资源信息<br>\n“version” :             资源的版本<br>\n“engineVersion” :       引擎版本<br>\n“assets” :              所有资源列表<br>\n“key” :             资源的相对路径（相对于资源根目录）<br>\n“md5” :             md5 值代表资源文件的版本信息<br>\n“compressed” :      [可选项] 如果值为 true，文件被下载后会自动被解压，目前仅支持 zip 压缩格式<br>\n“size” :            [可选项] 文件的字节尺寸，用于快速获取进度信息<br>\n“searchPaths” :         需要添加到 FileUtils 中的搜索路径列表<br>\n}<br>\n主要我们用到的是：version.manifest和project.manifest<br>\nversion.manifest:用来做版本对比<br>\nproject.manifest：下载链接和文件类型及数据</p>\n<h1 id=\"控制并发：\">控制并发：<a title=\"#控制并发：\" href=\"#控制并发：\"></a></h1>\n<p>Cocos Creator v1.4 和 Cocos2d-x v3.15 开始，热更新管理器添加了控制下载并发数量的 API，使用方式如下：<br>\nassetsManager.setMaxConcurrentTask(10);</p>\n",
            "tags": [
                "CoCosCreator"
            ]
        }
    ]
}